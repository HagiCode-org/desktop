# dependency-management Specification Delta

## Change ID
`onboarding-dependency-version-mismatch-handling`

---

## MODIFIED Requirements

### Requirement: 依赖状态可视化

应用 MUST 在依赖管理面板中以清晰直观的方式展示依赖状态，包括安装状态、版本信息和可用操作。

#### Scenario: 显示版本不匹配的依赖

**Given** 依赖已安装但版本低于要求
**When** 渲染依赖管理面板
**Then** 显示黄色 ⚠️ 图标
**And** 显示"版本不匹配"状态文本
**And** 显示当前版本和要求的版本范围
**And** 显示"升级"或"重新安装"按钮
**And** 在引导流程中，将版本不匹配的依赖视为需要处理的状态

#### Scenario: 引导流程显示混合依赖状态

**Given** 引导流程中检测到多个依赖
**And** 其中部分完全缺失，部分版本不匹配
**When** 渲染依赖安装步骤
**Then** 分别统计缺失和版本不匹配的依赖数量
**And** 显示清晰的提示信息，如"检测到 X 个缺失和 Y 个版本不匹配的依赖"
**And** 提供统一的安装/升级操作按钮
**And** 说明版本不匹配的依赖将自动升级到要求的版本

#### Scenario: 引导流程仅版本不匹配的依赖

**Given** 引导流程中检测到多个依赖
**And** 所有依赖都已安装但存在版本不匹配
**When** 渲染依赖安装步骤
**Then** 显示"检测到 N 个版本不匹配的依赖"
**And** 提示这些依赖需要升级才能正常运行
**And** 提供统一的升级操作按钮

---

## ADDED Requirements

### Requirement: 引导流程依赖版本处理

首次使用引导流程 MUST 能够正确识别和处理依赖版本不匹配的情况，确保用户在完成引导前所有依赖（包括版本不匹配的）都被正确识别并安装/升级。

#### Scenario: 检测依赖时包含版本不匹配状态

**Given** 用户进入引导流程的依赖检查步骤
**When** 系统执行依赖检测
**Then** 返回所有需要处理的依赖（缺失和版本不匹配）
**And** 版本不匹配的依赖被标记为需要修复
**And** 提供当前版本和要求的版本信息

#### Scenario: 安装流程处理版本不匹配依赖

**Given** 用户触发依赖安装操作
**And** 依赖列表包含版本不匹配的项目
**When** 执行安装流程
**Then** 对版本不匹配的依赖执行升级操作
**And** 对完全缺失的依赖执行全新安装
**And** 完成后验证所有依赖满足版本要求

#### Scenario: 引导流程完成条件检查

**Given** 用户完成依赖安装步骤
**When** 系统验证是否可以进入下一步
**Then** 检查所有依赖是否已安装且版本匹配
**And** 仅当所有依赖都满足要求时允许继续
**And** 存在版本不匹配的依赖时阻止继续并提示用户
